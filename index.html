<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/lovable-uploads/6ae2b882-22a7-4999-9254-825d31ea2b05.png" type="image/png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Hero text transition style -->
    <style>
      [data-hero-container] { 
        opacity: 0; 
        transition: opacity 0.4s ease-in-out;
      }
      [data-hero-container].ready { 
        opacity: 1; 
      }
    </style>
    <title>StartWise - Turn Your Ideas Into Real Businesses</title>
    <meta name="description" content="We help entrepreneurs validate, design, and launch successful startups. From feasibility studies to MVP development - your complete tech partner with 98% success rate." />
    <meta name="keywords" content="startup development, MVP development, business validation, feasibility study, UI UX design, entrepreneur services" />
    <meta name="author" content="StartWise" />

    <meta property="og:title" content="StartWise - Turn Your Ideas Into Real Businesses" />
    <meta property="og:description" content="We help entrepreneurs validate, design, and launch successful startups. From feasibility studies to MVP development - your complete tech partner with 98% success rate." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://startwise.com/og-image.jpg" />
    <meta property="og:url" content="https://startwise.com" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="StartWise - Turn Your Ideas Into Real Businesses" />
    <meta name="twitter:description" content="We help entrepreneurs validate, design, and launch successful startups. From feasibility studies to MVP development - your complete tech partner with 98% success rate." />
    <meta name="twitter:image" content="https://startwise.com/og-image.jpg" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
    
    <!-- Dynamic Hero Copy Script -->
    <script>
    (function() {
      // Get keyword from URL parameter
      const urlParams = new URLSearchParams(window.location.search);
      const keyword = urlParams.get('keyword');
      
      if (!keyword) {
        console.log('[Dynamic Hero] No keyword parameter found, using default content');
        // No keyword, show default content immediately
        if (window.__HERO_READY__) {
          window.__HERO_READY__();
        }
        return;
      }

      // Check if server already injected the content
      const heroContainer = document.querySelector('[data-hero-container]');
      if (heroContainer && heroContainer.classList.contains('ready')) {
        console.log('[Dynamic Hero] Server-side content detected, skipping fetch');
        return;
      }

      // Check if window.__HERO_TEXT__ was injected by server
      if (window.__HERO_TEXT__) {
        console.log('[Dynamic Hero] Using server-injected variant');
        const isMobile = window.innerWidth < 768;
        const heroText = isMobile ? (window.__HERO_TEXT__.subheadline || window.__HERO_TEXT__.headline) : window.__HERO_TEXT__.headline;
        if (heroContainer) {
          heroContainer.innerHTML = '<div style="white-space: pre-wrap;">' + heroText + '</div>';
          heroContainer.classList.add('ready');
        }
        if (window.__HERO_READY__) window.__HERO_READY__();
        return;
      }

      // Fallback to client-side fetch (only if server didn't inject)
      console.log('[Dynamic Hero] Loading variant for keyword:', keyword);

      // Detect if mobile or desktop
      const isMobile = window.innerWidth < 768;

      // Fetch approved variant from database
      fetch('https://fhomiyajinehlpxbwjxl.supabase.co/functions/v1/serve-variant?keyword=' + encodeURIComponent(keyword))
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            console.error('[Dynamic Hero] Variant fetch error:', data.error);
            if (window.__HERO_READY__) {
              window.__HERO_READY__();
            }
            return;
          }

          console.log('[Dynamic Hero] Variant data received:', data);

          // Wait for hero container to exist
          function updateHero() {
            const heroContainer = document.querySelector('[data-hero-container]');
            
            if (!heroContainer) {
              console.log('[Dynamic Hero] Hero container not found yet, retrying...');
              setTimeout(updateHero, 50);
              return;
            }

            // Get the appropriate text (desktop or mobile)
            const heroText = isMobile ? (data.subheadline || data.headline) : data.headline;
            
            // Replace entire content with the full hero text
            heroContainer.innerHTML = '<div style="white-space: pre-wrap;">' + heroText + '</div>';
            
            console.log('[Dynamic Hero] Content updated, revealing hero');
            
            // Reveal the hero text
            if (window.__HERO_READY__) {
              window.__HERO_READY__();
            }
          }
          
          updateHero();
        })
        .catch(error => {
          console.error('[Dynamic Hero] Error loading dynamic content:', error);
          // On error, reveal with default content
          if (window.__HERO_READY__) {
            window.__HERO_READY__();
          }
        });
    })();
    </script>
    
    <!-- Hero Reveal Script -->
    <script>
    (function(){
      console.log('[Hero Reveal] Script starting');
      
      var revealed = false;
      
      function revealHero(){
        if (revealed) return;
        revealed = true;
        
        var heroContainer = document.querySelector('[data-hero-container]');
        if (heroContainer) {
          console.log('[Hero Reveal] Adding ready class to show hero');
          heroContainer.classList.add('ready');
        }
      }
      
      function hasHero(){
        var el = document.querySelector('[data-hero-container]');
        var hasContent = !!(el && el.textContent && el.textContent.trim().length > 0);
        console.log('[Hero Reveal] hasHero check:', hasContent, el ? 'Element found' : 'Element not found');
        return hasContent;
      }
      
      // Expose reveal function for dynamic script to call
      window.__HERO_READY__ = revealHero;
      
      // Check if we have a keyword parameter
      var urlParams = new URLSearchParams(window.location.search);
      var hasKeyword = urlParams.get('keyword');
      
      if (!hasKeyword) {
        console.log('[Hero Reveal] No keyword param, revealing when hero loads normally');
        
        // No dynamic content, reveal when React renders
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function(){
            console.log('[Hero Reveal] DOMContentLoaded fired');
            setTimeout(function(){
              if(hasHero()) revealHero();
            }, 100);
          });
        } else {
          setTimeout(function(){
            if(hasHero()) revealHero();
          }, 100);
        }
        
        // Watch for hero container
        var obs = new MutationObserver(function(){
          if(hasHero()){
            console.log('[Hero Reveal] MutationObserver detected hero content');
            revealHero();
            obs.disconnect();
          }
        });
        obs.observe(document.documentElement, {childList: true, subtree: true, characterData: true});
      } else {
        console.log('[Hero Reveal] Keyword param detected, waiting for dynamic script');
        // With keyword, dynamic script will call revealHero after updating content
      }
      
      // Fallback timeout - always reveal eventually
      setTimeout(function(){
        console.log('[Hero Reveal] Timeout fallback triggered');
        revealHero();
      }, 3500);
    })();
    </script>
  </body>
</html>
